---
title: "Computational Skills for Biostatistics I: Lecture 7"
author: Amy Willis, Biostatistics, UW
date: November 8, 2017
output:
  beamer_presentation:
    includes:
      in_header: ../lecture3/header_pagenrs.tex
    fig_caption: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      size = "footnotesize",
                      error=TRUE,
                      fig.align="center")
library(ggplot2)
library(tidyverse)
library(magrittr)
library(gapminder)
```

# R packages

Why write an R package?

- The best way to contribute to science
- Allow others to build on your advances
- Promote yourself and your work
- Pass this class


$$ \text{package} = \text{code} + \text{other stuff} $$

This class will focus on the other stuff

# Install versus load

Brief refresher: `install.packages()` downloads the package from CRAN, and `library()` loads the library

- Loads the library? `attach()`-es it
    - Adds it to search path

# Attaching

Recall from homework 1 that you can `attach()` data frames

```{r}
attach(women)
height
height <- height*2.54
height
women$height
```

# Attaching

Loading a library places its functions in the search path, but the global environment will always be in the first position

```{r}
ggplot  <- function(...) "Ha! Overwritten!"
library(ggplot2)
ggplot(iris, aes(x = Sepal.Length, y = Petal.Width))
```

# Attach

Moral of the story: Don't attach data frames, but it's fine to attach packages

\center ![](IMG_8443.JPG){width=200px}

\footnotesize{If I ever used `require()` please forget it and use `library()` instead}

# Accessing functions in packages

The operator `x::y` means "the function `y` in the namespace of package `x`"

```{r, fig.width=2, fig.height=2}
ggplot  <- function(...) "Ha! Overwritten!"
ggplot2::ggplot(iris, aes(x = Sepal.Length, 
                          y = Petal.Width))
```

# Namespaces

All packages have a `NAMESPACE` file: a collection of objects to be exported and imported

- To avoid overwriting users' variables
- To avoid ambiguity in function calls
- To ensure the package has everything it needs to run
- To encourage modular code

Your `NAMESPACE` is auto generated using *tags*; never directly modify your `NAMESPACE` file

# Starting an R package

Ideally, create packages from scratch as soon as you begin on a project

- RStudio->File->New project->New Directory->R Package

![](firstpackage.png){width=300px}


# Starting an R package: `DESCRIPTION`

Short-term: Keeps track of imports (dependencies)

Long-term: Help others find your package

![](description.png){width=350px}

# Writing R packages: documentation

`roxygen` documentation makes everything incredibly easy

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("hadley/devtools")
install.packages("roxygen2")
```

# Writing R packages: documentation

Under the `Build` tab, under Build tools, check `Generate documentation with Roxygen`

![](build1.png){width=400px}

# Writing R packages: documentation

1. Delete the default `NAMESPACE` file and the `man` folder
2. Write `roxygen` comments in your `.R` file
    - `roxygen` comments start with `#'`
3. `cmd/ctrl + shift + b` builds the package
4. `cmd/ctrl + shift + d` autogenerates documentation based on your roxygen comments

# Writing R packages: documentation

![](roxygen.png){width=400px}

# Writing R packages: documentation

![](documentation.png){width=400px}

# Writing R packages: documentation

![](namespace.png){width=400px}

# Writing R packages: documentation

![](helpfiles.png){width=500px}

# Writing R packages: tags


![](roxygen2.png){width=400px}

# Writing R packages: documentation

![](namespace2.png){width=400px}

# Building packages

Core "other stuff" for a package

- Code: written by you, goes into `R` folder (no subdirectories allowed)
- `DESCRIPTION`: written by you
- Documentation: autogenerated by `roxygen` comments, goes into `man` folder
- `NAMESPACE`: autogenerated by `roxygen` comments

# documentation: vignettes

![](vignette1.png){width=400px}

# documentation: vignettes


![](vignette2.png){width=400px}


# Other things to keep in mind

1. `testthat` is a H.W. package to write unit tests
2. Datasets take a special format
    - Don't release data in the same way as functions
3. `rm(list=ls(all=TRUE))` removes everything in the global environment
    - But not packages!
4. Consider making custom classes (S3 or S4)
5. `pkgdown` is a H.W. package that can autogenerate a website `build_site()`

# Coming up

- New homework: your first R package
- Homework due Tuesday 21 November
    - Good luck with your 512 mid-term!
    - Move office hours from 3 p.m. Tuesday 14 November to 3 p.m. Friday 17 November
- Next week: scripting + departmental computing with Brian Williamson
